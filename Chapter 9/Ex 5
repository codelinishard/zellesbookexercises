#capitalisation inconsistency aside, this seems to work, though

from random import random

def main():
    printIntro()
    probA, probB, n = getInputs()
    rallyWinA, rallyWinB = SimNRallyGames(n,probA,probB)
    regWinA, regWinB = SimNRegGames(n,probA,probB)
    printSummary(probA,probB,rallyWinA,rallyWinB,regWinA,regWinB)

def printIntro():
    print("""
This program compares regular and rally scoring volleyball 
between two teams. It will investigate whether rally scoring 
has an effect on the relative advantage enjoyed by the better team.""")

def getInputs():
    # Returns the three simulation parameters
    a = float(input("What is the prob. teams A wins a serve? "))
    b = float(input("What is the prob. teams B wins a serve? "))
    n = int(input("Best of how many games? "))
    return a, b, n

def SimNRallyGames(n,probA,probB):
    #simulates rally games
    winsA = 0
    winsB = 0
    for i in range(n):
        if i%2 == 0: #i starts at 0 
            firstserve = "A"
        else:
            firstserve = "B"
        scoreA, scoreB = simOneRally(probA, probB,firstserve)
        if scoreA > scoreB:
            winsA = winsA + 1
        else:
            winsB = winsB + 1
    return winsA, winsB

def simOneRally(probA, probB,firstserve):
    # Simulates a single game of volleyball between players whose
    # abilities are represented by the probability of winning a serve.
    # Returns final scores for A and B
    serving = firstserve
    scoreA = 0
    scoreB = 0
    while not rallyOver(scoreA, scoreB):
        if serving == "A":
            if random() < probA:
                scoreA = scoreA + 1
            else: scoreB = scoreB + 1
            serving = "B"
        else:
            if random() < probB:
                scoreB = scoreB + 1
            else: scoreA = scoreA + 1
            serving = "A"
    return scoreA, scoreB

def rallyOver(a, b):
    # a and b represent scores for a racquetball game
    # Returns True if the game is over, False otherwise.
    return (a==25) or (b==25)

def SimNRegGames(n,probA,probB):
    winsA = 0
    winsB = 0
    for i in range(n):
        if i%2 == 0: #i starts at 0 
            firstserve = "A"
        else:
            firstserve = "B"
        scoreA, scoreB = simOneReg(probA, probB,firstserve)
        if scoreA > scoreB:
            winsA = winsA + 1
        else:
            winsB = winsB + 1
    return winsA, winsB
def simOneReg(probA,probB,firstserve):
    serving = firstserve
    scoreA = 0
    scoreB = 0
    while not RegOver(scoreA, scoreB):
        if serving == "A":
            if random() < probA:
                scoreA = scoreA + 1
            else: serving = "B"
        else:
            if random() < probB:
                scoreB = scoreB + 1
            else: serving = "A"
    return scoreA, scoreB
def RegOver(a,b):
    return (a>=15 and a-b>=2) or (b>=15 and b-a>=2)

def printSummary(probA,probB,rallyA,rallyB,regA,regB):
    print()
    betterTeam = "Team A"
    if probA > probB:
        print("Team A is the better team.")
        rallywinrate = rallyA/(rallyA+rallyB)
        regwinrate = regA/(regA+regB)
    elif probB > probA:
        betterTeam = "Team B"
        print("Team B is the better team") 
        rallywinrate = rallyB/(rallyA+rallyB)
        regwinrate = regB/(regA+regB)
    else: 
        print("The teams are equal and any difference in scoring between the systems are coincidences")
        return
    if rallywinrate > regwinrate:
            print(f"rallying magnified the relative advantage as {betterTeam} scored better when rallying.")
            print(f"Rally winrate: {rallywinrate:.1%}")
            print(f"Regular game winrate: {regwinrate:.1%}")
    elif rallywinrate < regwinrate:
        print(f"rallying reduced the relative advantage as {betterTeam} scored worse when rallying.")
        print(f"Rally winrate: {rallywinrate:.1%}")
        print(f"Regular game winrate: {regwinrate:.1%}")
    else:
        print(f"rallying did not change the relative advantage as {betterTeam} scored the same when rallying.")
        print(f"Rally winrate: {rallywinrate:.1%}")
        print(f"Regular game winrate: {regwinrate:.1%}")
    print("Although, if the number of games played was low, it could just be happenstance that one system scored better than the other.")

main()
